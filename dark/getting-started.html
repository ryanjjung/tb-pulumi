<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Patterns of Use" href="patterns.html" /><link rel="prev" title="tb_pulumi Documentation" href="index.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Getting Started - tb_pulumi documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">tb_pulumi  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">tb_pulumi  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns.html">Patterns of Use</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="modules.html">tb_pulumi</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of tb_pulumi</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="tb_pulumi.html">tb_pulumi</a></li>
<li class="toctree-l2"><a class="reference internal" href="ci.html">tb_pulumi.ci</a></li>
<li class="toctree-l2"><a class="reference internal" href="cloudfront.html">tb_pulumi.cloudfront</a></li>
<li class="toctree-l2"><a class="reference internal" href="constants.html">tb_pulumi.constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2.html">tb_pulumi.ec2</a></li>
<li class="toctree-l2"><a class="reference internal" href="fargate.html">tb_pulumi.fargate</a></li>
<li class="toctree-l2"><a class="reference internal" href="network.html">tb_pulumi.network</a></li>
<li class="toctree-l2"><a class="reference internal" href="rds.html">tb_pulumi.rds</a></li>
<li class="toctree-l2"><a class="reference internal" href="secrets.html">tb_pulumi.secrets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring Resources</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/getting-started.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Link to this heading">¶</a></h1>
<p>The classes in this module are intended to provide easy access to common infrastructural patterns in use at Thunderbird.
This should…</p>
<ul class="simple">
<li><p>help you set up a Pulumi project,</p></li>
<li><p>reduce most infrastructure configuration to values in a YAML file,</p></li>
<li><p>simplify the process of building complete infrastructural patterns.</p></li>
</ul>
<p>As such, it is somewhat opinionated, requires certain usage patterns, and strongly suggests some usage conventions.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h2>
<p>To use this module, you’ll need to get through this checklist first:</p>
<ul class="simple">
<li><p>Ensure Python 3.12 or greater is installed on your system.</p></li>
<li><p><a class="reference external" href="https://www.pulumi.com/docs/iac/download-install/">Install Pulumi</a>.</p></li>
<li><p>Understand the <a class="reference external" href="https://www.pulumi.com/docs/iac/concepts/">basic concepts of Pulumi</a>, particularly <a class="reference external" href="https://www.pulumi.com/docs/iac/concepts/resources/">Resources</a> and <a class="reference external" href="https://www.pulumi.com/docs/iac/concepts/resources/components/">Component Resources</a>.</p></li>
<li><p><a class="reference external" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">Configure awscli</a> with
your credentials and default region. (You do not have to install awscli, though you can
<a class="reference external" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">read how to here</a>.
Some of these docs refer to helpful awscli commands.)</p></li>
<li><p>Set up an <a class="reference internal" href="#s3-bucket">S3 bucket</a> to store your Pulumi state in.</p></li>
</ul>
<p>The <a class="reference internal" href="#troubleshooting">Troubleshooting</a> section has some details on how to work through some issues related to setup.</p>
</section>
<section id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading">¶</a></h2>
<p>After ensuring you meet the above prerequisites, run the <code class="docutils literal notranslate"><span class="pre">quickstart.sh</span></code> script, adjusting the following command to
refer to your particular project details:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">quickstart</span><span class="o">.</span><span class="n">sh</span> \
  <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">root</span>          <span class="c1"># The root of your code project where you want to set up a pulumi project</span>
  <span class="n">pulumi</span><span class="o">-</span><span class="n">state</span><span class="o">-</span><span class="n">s3</span><span class="o">-</span><span class="n">bucket</span><span class="o">-</span><span class="n">name</span> \  <span class="c1"># S3 bucket where you&#39;ll store your pulumi state files</span>
  <span class="n">project_name</span><span class="p">,</span> \                <span class="c1"># Name of your project as it will be known to pulumi</span>
  <span class="n">stack_name</span><span class="p">,</span> \                  <span class="c1"># Name of the first stack you want to create</span>
  <span class="p">[</span><span class="n">code_version</span><span class="p">]</span>                 <span class="c1"># Code version (git branch) that you want to pin. Optional; defaults to &quot;main&quot;</span>
</pre></div>
</div>
<p>This will…</p>
<ul class="simple">
<li><p>run you through some prompts where you can enter further project details,</p></li>
<li><p>install a simple Pulumi program intended to set up a basic networking landscape,</p></li>
<li><p>run a <code class="docutils literal notranslate"><span class="pre">pulumi</span> <span class="pre">preview</span></code> command to finish setting up the environment and confirm the project is working.</p></li>
</ul>
<p>The output should look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Previewing update (mystack):
     Type                              Name                                 Plan
 +   pulumi:pulumi:Stack               myproject-mystack                    create
 +   ├─ tb:network:MultiCidrVpc        myproject-mystack-vpc                create
 +   │  ├─ aws:ec2:Vpc                 myproject-mystack-vpc                create
 +   │  ├─ aws:ec2:Subnet              myproject-mystack-vpc-subnet-0       create
 +   │  ├─ aws:ec2:Subnet              myproject-mystack-vpc-subnet-1       create
 +   │  └─ aws:ec2:Subnet              myproject-mystack-vpc-subnet-2       create
 +   ├─ aws:ec2:RouteTableAssociation  myproject-mystack-vpc-subnetassoc-0  create
 +   ├─ aws:ec2:RouteTableAssociation  myproject-mystack-vpc-subnetassoc-1  create
 +   └─ aws:ec2:RouteTableAssociation  myproject-mystack-vpc-subnetassoc-2  create

Resources:
    + 9 to create
</pre></div>
</div>
</section>
<section id="manual-setup">
<h2>Manual Setup<a class="headerlink" href="#manual-setup" title="Link to this heading">¶</a></h2>
<section id="s3-bucket">
<h3>S3 bucket<a class="headerlink" href="#s3-bucket" title="Link to this heading">¶</a></h3>
<p>Create an S3 bucket in which to store state for the project. You must have one bucket devoted to your project, but you
can store multiple stacks’ state files in that one bucket. The bucket should not be public (treat these files as
sensitive), and it’s a good idea to turn on versioning, as it can save you from some difficult situations down the road.</p>
<p>The name of an S3 bucket is used as part of a global domain, and so your bucket name must be globally unique. A good way
to handle this is to include an organization name in your bucket name. As a template, you may use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ORG-$PROJECT_NAME-pulumi
</pre></div>
</div>
</section>
<section id="repo-setup">
<h3>Repo setup<a class="headerlink" href="#repo-setup" title="Link to this heading">¶</a></h3>
<p>You probably already have a code repo with your application code in it. If not, create such a repo.</p>
<p>Create a directory there called <code class="docutils literal notranslate"><span class="pre">pulumi</span></code> and create a new project and stack in it. You’ll need the name of the S3
bucket from the previous step here. If you are operating in an AWS region other than what is set as your default for
AWSCLI, be sure to <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">AWS_REGION=us-east-1</span></code> or whatever else you may need to do to override that.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">pulumi</span><span class="o">/</span><span class="n">code</span>
<span class="n">pulumi</span> <span class="n">login</span> <span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">s3</span><span class="o">-</span><span class="n">bucket</span><span class="o">-</span><span class="n">name</span>
<span class="n">pulumi</span> <span class="n">new</span> <span class="n">aws</span><span class="o">-</span><span class="n">python</span>
</pre></div>
</div>
<p>Follow the prompts to get everything named.</p>
</section>
<section id="set-up-this-module">
<h3>Set up this module<a class="headerlink" href="#set-up-this-module" title="Link to this heading">¶</a></h3>
<p>Ensure your pulumi code directory contains a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file with at least this repo listed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">thunderbird</span><span class="o">/</span><span class="n">pulumi</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>You can pin your code to a specific version of this module by appending <code class="docutils literal notranslate"><span class="pre">&#64;branch_name</span></code> to that. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">thunderbird</span><span class="o">/</span><span class="n">pulumi</span><span class="o">.</span><span class="n">git</span><span class="nd">@v0</span><span class="mf">.0.2</span>
</pre></div>
</div>
<p>Pulumi will need these requirements installed. On your first run of a <code class="docutils literal notranslate"><span class="pre">pulumi</span> <span class="pre">preview</span></code> command (or some others),
Pulumi will attempt to set up its working environment. If this fails, or you need to make adjustments later, you can
activate Pulumi’s virtual environment to perform pip changes. Assuming Pulumi’s virtual environment lives at <code class="docutils literal notranslate"><span class="pre">venv</span></code>,
run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">./</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>You can now develop Python Pulumi code in that directory, referring to this module with imports such as these:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tb_pulumi</span>

<span class="c1"># ...or...</span>

<span class="kn">from</span> <span class="nn">tb_pulumi</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ec2</span><span class="p">,</span> <span class="n">fargate</span><span class="p">,</span> <span class="n">secrets</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="use-this-module">
<h3>Use this module<a class="headerlink" href="#use-this-module" title="Link to this heading">¶</a></h3>
<p>When you issue <code class="docutils literal notranslate"><span class="pre">pulumi</span></code> commands (like “up” and “preview” and so on), it looks for a <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> file in your
current directory and executes the code in that file. To use this module, you’ll import it into that file and write up
some code and configuration files.</p>
<section id="create-a-config-file">
<h4>Create a config file<a class="headerlink" href="#create-a-config-file" title="Link to this heading">¶</a></h4>
<p>It is assumed that a config file will exist at <code class="docutils literal notranslate"><span class="pre">config.$STACK.yaml</span></code> where <code class="docutils literal notranslate"><span class="pre">$STACK</span></code> is the currently selected Pulumi
stack. This file must contain a mapping of names of config settings to their desired values. Currently, only one such
setting is formally recognized. That is <code class="docutils literal notranslate"><span class="pre">resources</span></code>.</p>
<p>This is a mostly arbitary mapping that you will have to interpret on your own. This allows for flexibility, but we
recommend some conventions here. Namely:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">resources</span></code> should be a mapping where the keys are the Pulumi type-strings for the resources they are configuring.
For example, if you want to build a VPC with several subnets, you might use the <code class="docutils literal notranslate"><span class="pre">tb_pulumi.network.MultiCidrVpc</span></code>
class. Following this convention, that should be accompanied by a <code class="docutils literal notranslate"><span class="pre">tb:network:MultiCidrVpc</span></code> key in this mapping.</p></li>
<li><p>The values these keys map to should themselves be mappings. This provides a convention where more than one of each
pattern are configurable. The keys here should be arbitrary but unique identifiers for the resources being configured.
F/ex: <code class="docutils literal notranslate"><span class="pre">backend</span></code> or <code class="docutils literal notranslate"><span class="pre">api</span></code>.</p></li>
<li><p>The values these keys map to should be a mapping where the keys are valid configuration options for the resources
being built. The full listing of these values can be found by browsing the documentation. A barebones example can be
found in our <a class="reference external" href="https://github.com/thunderbird/pulumi/blob/main/config.stack.yaml.example">configuration example</a>.</p></li>
</ul>
</section>
<section id="define-a-thunderbirdpulumiproject">
<h4>Define a ThunderbirdPulumiProject<a class="headerlink" href="#define-a-thunderbirdpulumiproject" title="Link to this heading">¶</a></h4>
<p>In your <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> file, start with a simple skeleton (or use <code class="docutils literal notranslate"><span class="pre">__main__.py.example</span></code> to start):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tb_pulumi</span>
<span class="n">project</span> <span class="o">=</span> <span class="n">tb_pulumi</span><span class="o">.</span><span class="n">ThunderbirdPulumiProject</span><span class="p">()</span>
</pre></div>
</div>
<p>If you have followed the conventions outlined above, <code class="docutils literal notranslate"><span class="pre">project</span></code> is now an object with a key property, <code class="docutils literal notranslate"><span class="pre">config</span></code>, which
gives you access to the config file’s data. You can use this in the next step to feed parameters into resource
declarations.</p>
</section>
<section id="declare-thunderbirdcomponentresources">
<h4>Declare ThunderbirdComponentResources<a class="headerlink" href="#declare-thunderbirdcomponentresources" title="Link to this heading">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">pulumi.ComponentResource</span></code> is a collection of related resources. In an effort to follow consistent patterns across
infrastructure projects, the resources available in this module all extend a custom class called a
<code class="docutils literal notranslate"><span class="pre">ThunderbirdComponentResource</span></code>. If you have followed the conventions outlined so far, it should be easy to stamp out
common patterns with them by passing config options into the constructors for these classes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="#quickstart">Quickstart</a> section provides a working minimal example of code that follows these patterns.</p>
</div>
</section>
<section id="implementing-thunderbirdcomponentresources">
<h4>Implementing ThunderbirdComponentResources<a class="headerlink" href="#implementing-thunderbirdcomponentresources" title="Link to this heading">¶</a></h4>
<p>So you want to develop a new pattern to stamp out? Here’s what you’ll need to do:</p>
<ul class="simple">
<li><p>Determine the best place to put the code. Is there an existing module that fits the bill?</p></li>
<li><p>Determine the Pulumi type string for it. This goes: <code class="docutils literal notranslate"><span class="pre">org:module:class</span></code>. The <code class="docutils literal notranslate"><span class="pre">org</span></code> should be unique to your
organization. For Thunderbird projects, it should be <code class="docutils literal notranslate"><span class="pre">tb</span></code>. The <code class="docutils literal notranslate"><span class="pre">module</span></code> will be the Python submodule you’re
placing the new class in. The <code class="docutils literal notranslate"><span class="pre">class</span></code> is whatever you’ve called the class.</p></li>
<li><dl class="simple">
<dt>Design the class following these guidelines:</dt><dd><ul>
<li><dl class="simple">
<dt>The constructor should always accept, before any other arguments, the following positional options:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: The internal name of the resource as Pulumi tracks it.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">project</span></code>: The ThunderbirdPulumiProject these resources belong to.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The constructor should always accept the following keyword arguments:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">opts</span></code>: A <code class="docutils literal notranslate"><span class="pre">pulumi.ResourceOptions</span></code> object which will get merged into the default set of arguments managed
by the project.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>The constructor should explicitly define only those arguments that you intend to have default values which differ
from the default values the provider will set, or which imply larger patterns (such as <code class="docutils literal notranslate"><span class="pre">build_jumphost</span></code> implying
other resources, like a security group and its rules, not just an EC2 instance).</p></li>
<li><p>The constructor may accept a final <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> argument with arbitrary meaning. Because the nature of a component
resource is to compile many other resources into one class, it is not implicitly clear what “everything else”
should apply to. If this is implemented, its function should be clearly documented in the class.</p></li>
<li><p>The class should extend <code class="docutils literal notranslate"><span class="pre">tb_pulumi.ThunderbirdComponentResource</span></code>.</p></li>
<li><dl class="simple">
<dt>The class should call its superconstructor in the following way:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">super().__init__(typestring,</span> <span class="pre">name,</span> <span class="pre">project,</span> <span class="pre">opts=opts)</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Any resources you create must have the <code class="docutils literal notranslate"><span class="pre">parent=self</span></code> <code class="docutils literal notranslate"><span class="pre">pulumi.ResourceOption</span></code> set.</p></li>
<li><p>At the end of the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> function, you must call <code class="docutils literal notranslate"><span class="pre">self.finish()</span></code>, passing in a dictionary of <code class="docutils literal notranslate"><span class="pre">outputs</span></code>
and one of <code class="docutils literal notranslate"><span class="pre">resources</span></code> (see <a class="reference internal" href="tb_pulumi.html#tb_pulumi.ThunderbirdComponentResource.finish" title="tb_pulumi.ThunderbirdComponentResource.finish"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tb_pulumi.ThunderbirdComponentResource.finish()</span></code></a>).</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">¶</a></h2>
<section id="pythonic-problems">
<h3>Pythonic problems<a class="headerlink" href="#pythonic-problems" title="Link to this heading">¶</a></h3>
<p>This Pulumi code is developed against Python 3.12 or later. If this is not your default version, you’ll need to manage
your own virtual environment.</p>
<p>Check your default version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -V
Python 3.12.6
</pre></div>
</div>
<p>If you need a newer Python, <a class="reference external" href="https://www.python.org/downloads/">download and install it</a>. Then you’ll have to set up
the virtual environment yourself with something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">virtualenv</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">python3</span><span class="mf">.12</span> <span class="n">venv</span>
<span class="o">./</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>After this, <code class="docutils literal notranslate"><span class="pre">pulumi</span></code> commands should work. If 3.12 is your default version of Python, Pulumi should set up its own
virtualenv, and you should not have to do this.</p>
</section>
<section id="shells-other-than-bash">
<h3>Shells other than Bash<a class="headerlink" href="#shells-other-than-bash" title="Link to this heading">¶</a></h3>
<p>Setup instructions in these docs are designed for use with the Bourne Again SHell (Bash). Pulumi also seems to make some
assumptions like this when it installs itself. Pulumi will install itself into a hidden folder in your home directory:
<code class="docutils literal notranslate"><span class="pre">~/.pulumi/bin</span></code>. You may need to add this to your <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> to avoid having to make the explicit reference with every
<code class="docutils literal notranslate"><span class="pre">pulumi</span></code> command.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="patterns.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Patterns of Use</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Thunderbird
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Getting Started</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li><a class="reference internal" href="#manual-setup">Manual Setup</a><ul>
<li><a class="reference internal" href="#s3-bucket">S3 bucket</a></li>
<li><a class="reference internal" href="#repo-setup">Repo setup</a></li>
<li><a class="reference internal" href="#set-up-this-module">Set up this module</a></li>
<li><a class="reference internal" href="#use-this-module">Use this module</a><ul>
<li><a class="reference internal" href="#create-a-config-file">Create a config file</a></li>
<li><a class="reference internal" href="#define-a-thunderbirdpulumiproject">Define a ThunderbirdPulumiProject</a></li>
<li><a class="reference internal" href="#declare-thunderbirdcomponentresources">Declare ThunderbirdComponentResources</a></li>
<li><a class="reference internal" href="#implementing-thunderbirdcomponentresources">Implementing ThunderbirdComponentResources</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#pythonic-problems">Pythonic problems</a></li>
<li><a class="reference internal" href="#shells-other-than-bash">Shells other than Bash</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>